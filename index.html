<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Presentasi HTML</title>

  <!-- CodeMirror -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closetag.min.js"></script>

  <style>
    :root {
      --bg-color:#1a1a1a;
      --surface-color:#242424;
      --primary-color:#4a90e2;
      --primary-hover:#5aa1f2;
      --danger:#e24a4a;
      --danger-hover:#f25a5a;
      --text:#e0e0e0;
      --border:#3a3a3a;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg-color);color:var(--text);line-height:1.6;}

    .container{max-width:1200px;margin:0 auto;padding:1rem;}
    header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;padding-bottom:.5rem;margin-bottom:1rem;border-bottom:1px solid var(--border);}
    header h1{font-size:1.4rem;}
    .btn{background:var(--primary-color);color:#fff;border:none;padding:.6rem 1rem;border-radius:6px;cursor:pointer;font-size:.95rem;transition:.2s;}
    .btn:hover{background:var(--primary-hover)}
    .btn-secondary{background:#444;}
    .btn-secondary:hover{background:#555}
    .btn-danger{background:var(--danger);}
    .btn-danger:hover{background:var(--danger-hover)}

    #presentations-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem;}
    .presentation-card{background:var(--surface-color);border:1px solid var(--border);border-radius:10px;padding:1rem;display:flex;flex-direction:column;}
    .card-content{flex:1}
    .card-title{font-size:1rem;margin-bottom:.3rem;}
    .card-date{font-size:.8rem;color:#aaa;}
    .card-actions{display:flex;gap:.5rem;margin-top:.7rem}
    .card-actions .btn{flex:1;font-size:.8rem;padding:.5rem}

    /* Modal */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:.25s;z-index:1000;}
    .modal-overlay.visible{opacity:1;visibility:visible;}
    .modal-container{background:var(--surface-color);border-radius:10px;width:95%;max-width:900px;max-height:95vh;display:flex;flex-direction:column;overflow-y:auto;padding:1rem;position:relative;}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
    .modal-header h2{font-size:1.2rem;}
    .close-btn{background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer;}

    .form-group{margin-bottom:1rem;}
    .form-group label{display:block;margin-bottom:.3rem;font-weight:600}
    .form-group input{width:100%;padding:.6rem;border:1px solid var(--border);border-radius:6px;background:#333;color:var(--text);}

    .editor-container{flex:1;border:1px solid var(--border);border-radius:6px;min-height:200px;overflow:auto;}
    .CodeMirror{height:100%;min-height:200px;font-size:14px;}
    .modal-footer{margin-top:1rem;display:flex;justify-content:flex-end;gap:.5rem;flex-wrap:wrap;}
    #empty-state{text-align:center;padding:2rem;border:2px dashed var(--border);border-radius:10px;grid-column:1/-1;color:#aaa;}

    @media(max-width:600px){
      header{flex-direction:column;align-items:flex-start;gap:.5rem}
      .modal-container{padding:.6rem;}
      .modal-footer{flex-direction:column;align-items:stretch;}
      .modal-footer .btn{width:100%;}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Presentasi Lokal Anda</h1>
      <button id="add-new" class="btn" type="button">Buat Baru</button>
    </header>
    <main id="presentations-grid"></main>
  </div>

  <template id="card-template">
    <div class="presentation-card">
      <div class="card-content">
        <h3 class="card-title"></h3>
        <p class="card-date"></p>
      </div>
      <div class="card-actions">
        <button class="btn-secondary btn" data-action="edit" type="button">Edit</button>
        <button class="btn" data-action="view" type="button">Buka</button>
        <button class="btn-danger btn" data-action="delete" type="button">Hapus</button>
      </div>
    </div>
  </template>

  <!-- Modal -->
  <div id="editor-modal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h2 id="modal-title">Buat Presentasi</h2>
        <button class="close-btn" id="close-modal" aria-label="Tutup">&times;</button>
      </div>
      <form id="form" style="display:flex;flex-direction:column;flex:1;min-height:0;">
        <input type="hidden" id="presentation-id">
        <div class="form-group">
          <label for="title">Judul</label>
          <input type="text" id="title" required placeholder="Contoh: Laporan Q4">
        </div>
        <div class="form-group" style="flex:1;display:flex;flex-direction:column;min-height:0;">
          <label for="code">Kode HTML</label>
          <div class="editor-container"><textarea id="code"></textarea></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-secondary btn" id="cancel">Batal</button>
          <button type="submit" class="btn">Simpan</button>
        </div>
      </form>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded",()=>{
  const STORAGE_KEY="presentations_v2";
  let presentations=[];
  let editor;

  const grid=document.getElementById("presentations-grid");
  const addBtn=document.getElementById("add-new");
  const modal=document.getElementById("editor-modal");
  const closeBtn=document.getElementById("close-modal");
  const cancelBtn=document.getElementById("cancel");
  const form=document.getElementById("form");
  const titleInput=document.getElementById("title");
  const idInput=document.getElementById("presentation-id");
  const codeArea=document.getElementById("code");
  const cardTemplate=document.getElementById("card-template");

  function initEditor(){
    if(editor) return;
    editor=CodeMirror.fromTextArea(codeArea,{
      mode:"htmlmixed",
      theme:"material-darker",
      lineNumbers:true,
      lineWrapping:true,
      autoCloseTags:true
    });
  }

  function openModal(pres=null){
    form.reset();
    idInput.value="";
    initEditor();
    editor.setValue("");
    if(pres){
      document.getElementById("modal-title").textContent="Edit Presentasi";
      idInput.value=pres.id;
      titleInput.value=pres.title;
      editor.setValue(pres.html);
    }else{
      document.getElementById("modal-title").textContent="Buat Presentasi";
      editor.setValue("<!DOCTYPE html>\n<html>\n<head>\n<meta charset='utf-8'>\n<title>Judul</title>\n</head>\n<body>\n<h1>Slide Pertama</h1>\n</body>\n</html>");
    }
    modal.classList.add("visible");
    setTimeout(()=>editor.refresh(),50);
  }
  function closeModal(){modal.classList.remove("visible")}

  function save(){
    const id=idInput.value;
    const title=titleInput.value.trim();
    const html=editor.getValue();
    if(!title){alert("Judul kosong");return;}
    const now=Date.now();
    if(id){
      let p=presentations.find(x=>x.id===id);
      if(p){p.title=title;p.html=html;p.lastModified=now;}
    }else{
      presentations.push({id:"p-"+now,title,html,lastModified:now});
    }
    localStorage.setItem(STORAGE_KEY,JSON.stringify(presentations));
    render();
    closeModal();
  }

  function render(){
    grid.innerHTML="";
    if(!presentations.length){
      grid.innerHTML="<div id='empty-state'>Belum ada presentasi</div>";
      return;
    }
    presentations.sort((a,b)=>b.lastModified-a.lastModified);
    presentations.forEach(p=>{
      const card=cardTemplate.content.cloneNode(true);
      card.querySelector(".card-title").textContent=p.title;
      card.querySelector(".card-date").textContent="Update: "+new Date(p.lastModified).toLocaleString();
      const el=card.querySelector(".presentation-card");
      el.dataset.id=p.id;
      grid.appendChild(card);
    });
  }

  grid.addEventListener("click",e=>{
    const btn=e.target.closest("button");
    if(!btn) return;
    const card=btn.closest(".presentation-card");
    const id=card.dataset.id;
    const p=presentations.find(x=>x.id===id);
    if(!p) return;
    if(btn.dataset.action==="edit") openModal(p);
    if(btn.dataset.action==="delete"){
      if(confirm("Hapus?")){presentations=presentations.filter(x=>x.id!==id);localStorage.setItem(STORAGE_KEY,JSON.stringify(presentations));render();}
    }
    if(btn.dataset.action==="view"){
      const blob=new Blob([p.html],{type:"text/html"});
      const url=URL.createObjectURL(blob);
      window.open(url,"_blank");
      setTimeout(()=>URL.revokeObjectURL(url),2000);
    }
  });

  form.addEventListener("submit",e=>{e.preventDefault();save()});
  addBtn.addEventListener("click",()=>openModal());
  closeBtn.addEventListener("click",closeModal);
  cancelBtn.addEventListener("click",closeModal);

  // init
  try{presentations=JSON.parse(localStorage.getItem(STORAGE_KEY))||[]}catch{presentations=[]}
  render();
});
</script>
</body>
</html>